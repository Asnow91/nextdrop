<!doctype html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nuove Uscite Spotify · NextDrop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4" th:with="
    safeLimit=${limit != null ? limit : 20},
    safeCountry=${country != null && !#strings.isEmpty(country) ? country : 'IT'},
    safeOffset=${offset != null ? offset : 0},
    prevOffset=${safeOffset > 0 ? (safeOffset - safeLimit > 0 ? safeOffset - safeLimit : 0) : null},
    nextOffset=${safeOffset + safeLimit}
">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h3 m-0">Nuove Uscite Spotify</h1>
    <span class="text-muted">
      Mercato: <strong th:text="${safeCountry}">IT</strong> ·
      Limite: <strong th:text="${safeLimit}">20</strong> ·
      Offset: <strong th:text="${safeOffset}">0</strong>
    </span>
  </div>

  <div class="alert alert-danger" th:if="${error != null}" th:text="${error}"></div>

  <form class="row gy-2 gx-2 align-items-end mb-3" method="get" action="/new-releases">
    <div class="col-12 col-sm-4 col-md-3">
      <label for="country" class="form-label">Paese</label>
      <select id="country" name="country" class="form-select">
        <option value="IT" th:selected="${safeCountry == 'IT'}">Italia (IT)</option>
        <option value="US" th:selected="${safeCountry == 'US'}">USA (US)</option>
        <option value="JP" th:selected="${safeCountry == 'JP'}">Giappone (JP)</option>
        <option value="DE" th:selected="${safeCountry == 'DE'}">Germania (DE)</option>
        <option value="FR" th:selected="${safeCountry == 'FR'}">Francia (FR)</option>
        <option value="GB" th:selected="${safeCountry == 'GB'}">Regno Unito (GB)</option>
        <option value="BR" th:selected="${safeCountry == 'BR'}">Brasile (BR)</option>
        <option value="ES" th:selected="${safeCountry == 'ES'}">Spagna (ES)</option>
      </select>
    </div>

    <div class="col-6 col-sm-4 col-md-2">
      <label for="limit" class="form-label">Quanti (limit)</label>
      <select id="limit" name="limit" class="form-select">
        <option value="10" th:selected="${safeLimit == 10}">10</option>
        <option value="20" th:selected="${safeLimit == 20}">20</option>
        <option value="50" th:selected="${safeLimit == 50}">50</option>
      </select>
    </div>

    <div class="col-6 col-sm-4 col-md-2">
      <label for="offset" class="form-label">Offset</label>
      <input id="offset" name="offset" type="number" min="0" class="form-control" th:value="${safeOffset}">
    </div>

    <div class="col-12 col-md-auto">
      <button class="btn btn-primary w-100">Aggiorna</button>
    </div>
  </form>

  <div class="d-flex gap-2 mb-3">
    <a class="btn btn-outline-secondary"
       th:if="${prevOffset != null}"
       th:href="@{/new-releases(country=${safeCountry}, limit=${safeLimit}, offset=${prevOffset})}">
      ← Precedenti
    </a>
    <a class="btn btn-outline-secondary"
       th:href="@{/new-releases(country=${safeCountry}, limit=${safeLimit}, offset=${nextOffset})}">
      Successivi →
    </a>
  </div>

  <div th:if="${albums != null and #lists.size(albums) > 0}"
       class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
    <div class="col" th:each="a : ${albums}">
      <div class="card h-100 shadow-sm">
        <div class="ratio ratio-1x1 bg-light">
          <img th:if="${a.imageUrl != null and !#strings.isEmpty(a.imageUrl)}" th:src="${a.imageUrl}" class="card-img-top" alt="Cover">
          <div th:if="${a.imageUrl == null or #strings.isEmpty(a.imageUrl)}" class="d-flex align-items-center justify-content-center text-muted">no image</div>
        </div>
        <div class="card-body">
          <h5 class="card-title" th:text="${a.title}">Titolo</h5>
          <p class="card-text text-muted mb-3" th:text="${a.artist}">Artista</p>
          <a class="btn btn-success" th:href="${a.spotifyUrl}" target="_blank" rel="noopener">Ascolta su Spotify</a>
        </div>
      </div>
    </div>
  </div>

  <div th:if="${albums == null or #lists.size(albums) == 0}" class="alert alert-info">
    Nessun album disponibile per questi parametri.
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
